{"componentChunkName":"component---src-templates-docs-tsx","path":"/0.3/docs/custom-material-cn","result":{"data":{"markdownRemark":{"html":"<p>业务中可能有一些特殊的渲染需求，例如毛发效果，这时候就需要“自定义材质”去实现。通过使用 <em>material</em> 这个模块中的 <a href=\"$%7Bbook.api%7Dclasses/core.material.html\">Material</a> 和 <a href=\"$%7Bbook.api%7Dclasses/core.shader.html\">Shader</a> 这两个类，就可以将自己定义的 Shader 代码整合进入引擎的渲染流程。</p>\n<h2 id=\"创建-shader\" style=\"position:relative;\"><a href=\"#%E5%88%9B%E5%BB%BA-shader\" aria-label=\"创建 shader permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>创建 shader</h2>\n<p><a href=\"$%7Bbook.api%7Dclasses/core.shader.html\">Shader</a> 封装了顶点着色器、片元着色器、着色器预编译、平台精度、平台差异性。他的创建和使用非常方便，用户只需要关注 shader 算法本身，而不用纠结于使用什么精度，亦或是使用 GLSL 哪个版本的写法。\n下面是一个简单的demo:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Material<span class=\"token punctuation\">,</span> Shader<span class=\"token punctuation\">,</span> Color <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"oasis-engine\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//-- Shader 代码</span>\n<span class=\"token keyword\">const</span> vertexSource <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  uniform mat4 u_MVPMat;\n\n  attribute vec3 POSITION; \n\n  void main() {\n    gl_Position = u_MVPMat * vec4(POSITION, 1.0);\n  }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> fragmentSource <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  uniform vec4 u_color;\n\n  void main() {\n    gl_FragColor = u_color;\n  }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 创建 shader（整个 runtime 只需要创建一次）</span>\nShader<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"demo\"</span><span class=\"token punctuation\">,</span> vertexSource<span class=\"token punctuation\">,</span> fragmentSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 创建自定义材质</span>\n<span class=\"token keyword\">const</span> material <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Material</span><span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">,</span> Shader<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"demo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code>Shader.create()</code>用来将 shader 添加到引擎的缓存池子中，因此整个 runtime 只需要创建一次,接下来就可以通过 <a href=\"$%7Bbook.api%7Dclasses/core.shader.html#find\">Shader.find(name)</a> 来反复使用.\n<strong>注：引擎已经预先 create 了 blinn-phong、pbr、shadow-map、shadow、skybox、framebuffer-picker-color、trail。用户可以直接使用这些内置 shader，但是不能重名创建。</strong></p>\n<p>因为我们没有上传 <code>u_color</code>  变量，所以片元输出还是黑色的(uniform 默认值)，接下来我们来介绍下引擎内置的 shader 变量以及如何上传自定义变量。</p>\n<h2 id=\"内置-shader-变量\" style=\"position:relative;\"><a href=\"#%E5%86%85%E7%BD%AE-shader-%E5%8F%98%E9%87%8F\" aria-label=\"内置 shader 变量 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>内置 shader 变量</h2>\n<p>在上面，我们给 material 赋予了 shader，这个时候程序已经可以开始渲染了。需要注意的是，shader 代码中有两种变量，一种是<strong>逐顶点</strong>的 <code>attribute</code> 变量，另一种是<strong>逐 shader</strong> 的 <code>uniform</code> 变量。(在 GLSL300 后，统一为 in 变量)\n引擎已经自动上传了一些常用变量，用户可以直接在 shader 代码中使用，如顶点数据和 mvp 数据，下面是引擎默认上传的变量。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">逐顶点数据</th>\n<th align=\"left\">attribute name</th>\n<th align=\"left\">数据类型</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"left\">顶点</td>\n<td align=\"left\">POSITION</td>\n<td align=\"left\">vec3</td>\n</tr>\n<tr>\n<td align=\"left\">法线</td>\n<td align=\"left\">NORMAL</td>\n<td align=\"left\">vec3</td>\n</tr>\n<tr>\n<td align=\"left\">切线</td>\n<td align=\"left\">TANGENT</td>\n<td align=\"left\">vec4</td>\n</tr>\n<tr>\n<td align=\"left\">顶点颜色</td>\n<td align=\"left\">COLOR_0</td>\n<td align=\"left\">vec4</td>\n</tr>\n<tr>\n<td align=\"left\">骨骼索引</td>\n<td align=\"left\">JOINTS_0</td>\n<td align=\"left\">vec4</td>\n</tr>\n<tr>\n<td align=\"left\">骨骼权重</td>\n<td align=\"left\">WEIGHTS_0</td>\n<td align=\"left\">vec4</td>\n</tr>\n<tr>\n<td align=\"left\">第一套纹理坐标</td>\n<td align=\"left\">TEXCOORD_0</td>\n<td align=\"left\">vec2</td>\n</tr>\n<tr>\n<td align=\"left\">第二套纹理坐标</td>\n<td align=\"left\">TEXCOORD_1</td>\n<td align=\"left\">vec2</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th align=\"left\">逐 shader 数据</th>\n<th align=\"left\">uniform name</th>\n<th align=\"left\">数据类型</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"left\">canvas 分辨率</td>\n<td align=\"left\">u_resolution</td>\n<td align=\"left\">vec2</td>\n</tr>\n<tr>\n<td align=\"left\">视口矩阵</td>\n<td align=\"left\">u_viewMat</td>\n<td align=\"left\">mat4</td>\n</tr>\n<tr>\n<td align=\"left\">投影矩阵</td>\n<td align=\"left\">u_projMat</td>\n<td align=\"left\">mat4</td>\n</tr>\n<tr>\n<td align=\"left\">视口投影矩阵</td>\n<td align=\"left\">u_VPMat</td>\n<td align=\"left\">mat4</td>\n</tr>\n<tr>\n<td align=\"left\">视口逆矩阵</td>\n<td align=\"left\">u_viewInvMat</td>\n<td align=\"left\">mat4</td>\n</tr>\n<tr>\n<td align=\"left\">投影逆矩阵</td>\n<td align=\"left\">u_projInvMat</td>\n<td align=\"left\">mat4</td>\n</tr>\n<tr>\n<td align=\"left\">相机位置</td>\n<td align=\"left\">u_cameraPos</td>\n<td align=\"left\">vec3</td>\n</tr>\n<tr>\n<td align=\"left\">模型本地坐标系矩阵</td>\n<td align=\"left\">u_localMat</td>\n<td align=\"left\">mat4</td>\n</tr>\n<tr>\n<td align=\"left\">模型世界坐标系矩阵</td>\n<td align=\"left\">u_modelMat</td>\n<td align=\"left\">mat4</td>\n</tr>\n<tr>\n<td align=\"left\">模型视口矩阵</td>\n<td align=\"left\">u_MVMat</td>\n<td align=\"left\">mat4</td>\n</tr>\n<tr>\n<td align=\"left\">模型视口投影矩阵</td>\n<td align=\"left\">u_MVPMat</td>\n<td align=\"left\">mat4</td>\n</tr>\n<tr>\n<td align=\"left\">模型视口逆矩阵</td>\n<td align=\"left\">u_MVInvMat</td>\n<td align=\"left\">mat4</td>\n</tr>\n<tr>\n<td align=\"left\">法线逆转置矩阵</td>\n<td align=\"left\">u_normalMat</td>\n<td align=\"left\">mat4</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"上传-shader-变量\" style=\"position:relative;\"><a href=\"#%E4%B8%8A%E4%BC%A0-shader-%E5%8F%98%E9%87%8F\" aria-label=\"上传 shader 变量 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>上传 shader 变量</h2>\n<blockquote>\n<p><em>attribute 逐顶点数据的上传请参考 <a href=\"$%7Bbook.manual%7Dcomponent/geometry-renderer.md\">几何体渲染器</a>,这里不再赘述。</em></p>\n</blockquote>\n<p>除了内置的变量，我们可以在 shader 中上传任何自定义名字的变量(建议使用 u<em>** 、 v</em>** 分别表示 uniform、varying变量)，我们唯一要做的就是根据 shader 的变量类型，使用正确的接口。\n上传接口全部保存在 <a href=\"$%7Bbook.api%7Dclasses/core.shaderdata.html\">ShaderData</a> 中，而 shaderData 实例对象又分别保存在引擎的四大类 <a href=\"$%7Bbook.api%7Dclasses/core.scene.html\">Scene</a>、<a href=\"$%7Bbook.api%7Dclasses/core.camera.html\">Camera</a>、<a href=\"$%7Bbook.api%7Dclasses/core.renderer.html\">Renderer</a>、<a href=\"$%7Bbook.api%7Dclasses/core.material.html\">Material</a> 中，我们只需要分别往这些 shaderData 中调用接口，上传变量，引擎便会在底层自动帮我们组装这些数据，并进行判重等性能的优化。</p>\n<p><img src=\"https://gw.alipayobjects.com/mdn/rms_d27172/afts/img/A*yR97QbVx-QwAAAAAAAAAAAAAARQnAQ\"></p>\n<h3 id=\"shaderdata-分开的好处\" style=\"position:relative;\"><a href=\"#shaderdata-%E5%88%86%E5%BC%80%E7%9A%84%E5%A5%BD%E5%A4%84\" aria-label=\"shaderdata 分开的好处 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>shaderData 分开的好处</h3>\n<p>shaderData 分别保存在引擎的四大类 <a href=\"$%7Bbook.api%7Dclasses/core.scene.html\">Scene</a>、<a href=\"$%7Bbook.api%7Dclasses/core.camera.html\">Camera</a>、<a href=\"$%7Bbook.api%7Dclasses/core.renderer.html\">Renderer</a>、<a href=\"$%7Bbook.api%7Dclasses/core.material.html\">Material</a> 中，这样做的好处之一就是底层可以根据上传时机上传某一块 uniform，提升性能；另外，将材质无关的 shaderData 剥离出来，可以实现共享材质，比如两个 renderer ，共享了一个材质，虽然都要操控同一个 shader，但是因为这一部分 shader 数据的上传来源于两个 renderer 的 shaderData，所以是不会影响彼此的渲染结果的。</p>\n<p>如：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> renderer1ShaderData <span class=\"token operator\">=</span> renderer1<span class=\"token punctuation\">.</span>shaderData<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> renderer2ShaderData <span class=\"token operator\">=</span> renderer2<span class=\"token punctuation\">.</span>shaderData<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> materialShaderData <span class=\"token operator\">=</span> material<span class=\"token punctuation\">.</span>shaderData<span class=\"token punctuation\">;</span>\n\nmaterialShaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setColor</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_color\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Color</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nrenderer1ShaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setFloat</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_progross\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nrenderer2ShaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setFloat</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_progross\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"调用接口\" style=\"position:relative;\"><a href=\"#%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3\" aria-label=\"调用接口 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>调用接口</h3>\n<p>shader 中变量的类型和调用的接口对应关系如下:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">shader 类型</th>\n<th align=\"left\">ShaderData API</th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"left\">bool 、 int</td>\n<td align=\"left\">setInt( value: number )</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">float</td>\n<td align=\"left\">setFloat( value: number )</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">bvec2、ivec2、vec2</td>\n<td align=\"left\">setVector2( value:Vector2 )</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">bvec3、ivec3、vec3</td>\n<td align=\"left\">setVector3( value:Vector3 )</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">bvec4、ivec4、vec4</td>\n<td align=\"left\">setVector4( value:Vector4 )</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">mat4</td>\n<td align=\"left\">setMatrix( value:Matrix )</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">float[] 、vec2[] 、vec3[]、 vec4[] 、mat4[]</td>\n<td align=\"left\">setFloatArray( value:Float32Array )</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">bool[]、 int[] 、bvec2[]、 bvec3[] 、bvec4[]、 ivec2[]、 ivec3[] 、ivec4[]</td>\n<td align=\"left\">setIntArray( value:Int32Array )</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">sampler2D 、 samplerCube</td>\n<td align=\"left\">setTexture( value:Texture )</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">sampler2D[] 、 samplerCube[]</td>\n<td align=\"left\">setTextureArray( value:Texture[] )</td>\n<td align=\"left\"></td>\n</tr>\n</tbody>\n</table>\n<p>代码演示如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// shader\n\nuniform float u_float;\nuniform int u_int;\nuniform bool u_bool;\nuniform vec2 u_vec2;\nuniform vec3 u_vec3;\nuniform vec4 u_vec4;\nuniform mat4 u_matrix;\nuniform int u_intArray[10];\nuniform float u_floatArray[10];\nuniform sampler2D u_sampler2D;\nuniform samplerCube u_samplerCube;\nuniform sampler2D u_samplerArray[2];\n\n// GLSL 300:\n// in float u_float; \n// ...</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// shaderData 可以分别保存在 scene 、camera 、renderer、 material 中。</span>\n<span class=\"token keyword\">const</span> shaderData <span class=\"token operator\">=</span> material<span class=\"token punctuation\">.</span>shaderData<span class=\"token punctuation\">;</span>\n\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setFloat</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_float\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_int\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_bool\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setVector2</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_vec2\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector2</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setVector3</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_vec3\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector3</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setVector4</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_vec4\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vector4</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setMatrix</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_matrix\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Matrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setIntArray</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_intArray\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Int32Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setFloatArray</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_floatArray\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Float32Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setTexture</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_sampler2D\"</span><span class=\"token punctuation\">,</span> texture2D<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setTexture</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_samplerCube\"</span><span class=\"token punctuation\">,</span>textureCube<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setTextureArray</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_samplerArray\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>texture2D<span class=\"token punctuation\">,</span>textureCube<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>注：为了性能考虑，引擎暂不支持 结构体数组上传、数组单个元素上传。</strong></p>\n<h3 id=\"宏开关\" style=\"position:relative;\"><a href=\"#%E5%AE%8F%E5%BC%80%E5%85%B3\" aria-label=\"宏开关 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>宏开关</h3>\n<p>除了uniform 变量之外，引擎将 shader 中的<a href=\"https://www.wikiwand.com/en/OpenGL_Shading_Language\">宏定义</a>也视为一种变量，因为宏定义的开启/关闭 将生成不同的着色器变种，也会影响渲染结果。</p>\n<p>如 shader 中有这些宏相关的操作：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#ifdef DISCARD\n\tdiscard;\n#endif\n\n#ifdef LIGHT_COUNT\n\tuniform vec4 u_color[ LIGHT_COUNT ];\n#endif</code></pre></div>\n<p>也是通过 <a href=\"$%7Bbook.api%7Dclasses/core.shader.html#enableMacro\">ShaderData</a> 来操控宏变量：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// 开启宏开关</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">enableMacro</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DISCARD\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 关闭宏开关</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">disableMacro</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DISCARD\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 开启变量宏</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">enableMacro</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"LIGHT_COUNT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 切换变量宏。这里底层会自动 disable 上一个宏，即 “LIGHT_COUNT 3”</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">enableMacro</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"LIGHT_COUNT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 关闭变量宏</span>\nshaderData<span class=\"token punctuation\">.</span><span class=\"token function\">disableMacro</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"LIGHT_COUNT\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"渲染状态\" style=\"position:relative;\"><a href=\"#%E6%B8%B2%E6%9F%93%E7%8A%B6%E6%80%81\" aria-label=\"渲染状态 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>渲染状态</h2>\n<p>我们通过材质的 shader，四块 shaderData 决定了材质的渲染表现。但是渲染管线除了着色器的操作，还提供了一些渲染状态来使我们对可编程的输入输出进行一些额外配置和处理。\n因此，引擎提供了<a href=\"$%7Bbook.api%7Dclasses/core.renderstate-1.html\">RenderState</a> ，可以分别对<a href=\"$%7Bbook.api%7Dclasses/core.renderstate-1.html#blendstate\">混合状态（BlendState）</a>、<a href=\"$%7Bbook.api%7Dclasses/core.renderstate-1.html#depthstate\">深度状态（DepthState）</a>、<a href=\"$%7Bbook.api%7Dclasses/core.renderstate-1.html#stencilstate\">模版状态（StencilState）</a>、<a href=\"$%7Bbook.api%7Dclasses/core.renderstate-1.html#rasterstate\">光栅状态（RasterState）</a>进行配置。\n我们拿一个透明物体的标准渲染流程来举例，我们希望开启混合模式并设置混合因子，并且因为透明物体是叠加渲染的，所以我们还要关闭深度写入;</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> renderState <span class=\"token operator\">=</span> material<span class=\"token punctuation\">.</span>renderState<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 1. 设置颜色混合因子。</span>\n<span class=\"token keyword\">const</span> blendState <span class=\"token operator\">=</span> renderState<span class=\"token punctuation\">.</span>blendState<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> target <span class=\"token operator\">=</span> blendState<span class=\"token punctuation\">.</span>targetBlendState<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// src 混合因子为（As，As，As，As）</span>\ntarget<span class=\"token punctuation\">.</span>sourceColorBlendFactor <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>sourceAlphaBlendFactor <span class=\"token operator\">=</span>BlendFactor<span class=\"token punctuation\">.</span>SourceAlpha<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// dst 混合因子为（1 - As，1 - As，1 - As，1 - As）。</span>\ntarget<span class=\"token punctuation\">.</span>destinationColorBlendFactor <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>destinationAlphaBlendFactor <span class=\"token operator\">=</span> BlendFactor<span class=\"token punctuation\">.</span>OneMinusSourceAlpha<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 操作方式为 src + dst  */</span>\ntarget<span class=\"token punctuation\">.</span>colorBlendOperation <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>alphaBlendOperation <span class=\"token operator\">=</span> BlendOperation<span class=\"token punctuation\">.</span>Add<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 2. 关闭深度写入。</span>\n<span class=\"token keyword\">const</span> depthState <span class=\"token operator\">=</span> renderState<span class=\"token punctuation\">.</span>depthState<span class=\"token punctuation\">;</span>\ndepthState<span class=\"token punctuation\">.</span>writeEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 3. 设置透明渲染队列 （后面会讲为什么）</span>\nmaterial<span class=\"token punctuation\">.</span>renderQueueType <span class=\"token operator\">=</span> RenderQueueType<span class=\"token punctuation\">.</span>Transparent<span class=\"token punctuation\">;</span></code></pre></div>\n<p>有关渲染状态的更多选项可以分别查看相应的<a href=\"$%7Bbook.api%7Dclasses/core.renderstate-1.html\">API 文档</a> </p>\n<h2 id=\"渲染队列\" style=\"position:relative;\"><a href=\"#%E6%B8%B2%E6%9F%93%E9%98%9F%E5%88%97\" aria-label=\"渲染队列 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>渲染队列</h2>\n<p>至此，自定义材质已经非常完善了，但是也许我们还需要对物体的渲染顺序做一些处理，比如透明物体的渲染一般都是放在非透明队列后面的，因此，引擎提供了 <a href=\"$%7Bbook.api%7Denums/core.renderqueuetype.html\">渲染队列（RenderQueueType）</a> ，我们设置材质的渲染队列，可以决定这个材质在当前场景中的渲染顺序，引擎底层会对不同范围的渲染队列进行一些特殊处理，如 <a href=\"$%7Bbook.api%7Denums/core.renderqueuetype.html#transparent\">RenderQueueType.Transparent</a> 会从远到近进行渲染。值得注意的是渲染队列的值可以是枚举值加上任何自定义数字。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">material<span class=\"token punctuation\">.</span>renderQueueType <span class=\"token operator\">=</span> RenderQueueType<span class=\"token punctuation\">.</span>Opaque <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"封装自定义材质\" style=\"position:relative;\"><a href=\"#%E5%B0%81%E8%A3%85%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%90%E8%B4%A8\" aria-label=\"封装自定义材质 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>封装自定义材质</h2>\n<p>这部分的内容是结合上文所有内容，给用户一个简单的封装示例，希望对您有所帮助：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Material<span class=\"token punctuation\">,</span> Shader<span class=\"token punctuation\">,</span> Color<span class=\"token punctuation\">,</span> Texture2D<span class=\"token punctuation\">,</span> BlendFactor<span class=\"token punctuation\">,</span> RenderQueueType <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"oasis-engine\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//-- Shader 代码</span>\n<span class=\"token keyword\">const</span> vertexSource <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  uniform mat4 u_MVPMat;\n\n  attribute vec3 POSITION; \n  attribute vec2 TEXCOORD_0;\n  varying vec2 v_uv;\n\n  void main() {\n    gl_Position = u_MVPMat * vec4(POSITION, 1.0);\n    v_uv = TEXCOORD_0;\n  }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> fragmentSource <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  uniform vec4 u_color;\n  varying vec2 v_uv;\n\n  #ifdef TEXTURE\n    uniform sampler2D u_texture;\n  #endif\n\n  void main() {\n    vec4 color = u_color;\n\n    #ifdef TEXTURE\n      color *= texture2D(u_texture, v_uv);\n    #endif\n\n    gl_FragColor = color;\n\n  }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\nShader<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"demo\"</span><span class=\"token punctuation\">,</span>vertexSource<span class=\"token punctuation\">,</span>fragmentSource<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomMaterial</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Material</span><span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">set</span> <span class=\"token function\">texture</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> Texture2D<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>shaderData<span class=\"token punctuation\">.</span><span class=\"token function\">enableMacro</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TEXTURE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>shaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setTexture</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_texture\"</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>shaderData<span class=\"token punctuation\">.</span><span class=\"token function\">disableMacro</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TEXTURE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">set</span> <span class=\"token function\">color</span><span class=\"token punctuation\">(</span>val<span class=\"token operator\">:</span>Color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>shaderData<span class=\"token punctuation\">.</span><span class=\"token function\">setColor</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"u_color\"</span><span class=\"token punctuation\">,</span> val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// make it transparent</span>\n  <span class=\"token keyword\">set</span> <span class=\"token function\">transparent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> target <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderState<span class=\"token punctuation\">.</span>blendState<span class=\"token punctuation\">.</span>targetBlendState<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> depthState <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderState<span class=\"token punctuation\">.</span>depthState<span class=\"token punctuation\">;</span>\n\n    target<span class=\"token punctuation\">.</span>sourceColorBlendFactor <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>sourceAlphaBlendFactor <span class=\"token operator\">=</span> BlendFactor<span class=\"token punctuation\">.</span>SourceAlpha<span class=\"token punctuation\">;</span>\n    target<span class=\"token punctuation\">.</span>destinationColorBlendFactor <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>destinationAlphaBlendFactor <span class=\"token operator\">=</span> BlendFactor<span class=\"token punctuation\">.</span>OneMinusSourceAlpha<span class=\"token punctuation\">;</span>\n    depthState<span class=\"token punctuation\">.</span>writeEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderQueueType <span class=\"token operator\">=</span> RenderQueueType<span class=\"token punctuation\">.</span>Transparent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span>engine<span class=\"token operator\">:</span>Engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">,</span> Shader<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"demo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"业务中可能有一些特殊的渲染需求，例如毛发效果，这时候就需要“自定义材质”去实现。通过使用 "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"material"}]},{"type":"text","value":" 这个模块中的 "},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.material.html"},"children":[{"type":"text","value":"Material"}]},{"type":"text","value":" 和 "},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.shader.html"},"children":[{"type":"text","value":"Shader"}]},{"type":"text","value":" 这两个类，就可以将自己定义的 Shader 代码整合进入引擎的渲染流程。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"创建-shader","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%E5%88%9B%E5%BB%BA-shader","ariaLabel":"创建 shader permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"创建 shader"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.shader.html"},"children":[{"type":"text","value":"Shader"}]},{"type":"text","value":" 封装了顶点着色器、片元着色器、着色器预编译、平台精度、平台差异性。他的创建和使用非常方便，用户只需要关注 shader 算法本身，而不用纠结于使用什么精度，亦或是使用 GLSL 哪个版本的写法。\n下面是一个简单的demo:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"javascript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-javascript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" Material"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Shader"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Color "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"oasis-engine\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//-- Shader 代码"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" vertexSource "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","template-string"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\n  uniform mat4 u_MVPMat;\n\n  attribute vec3 POSITION; \n\n  void main() {\n    gl_Position = u_MVPMat * vec4(POSITION, 1.0);\n  }\n  "}]},{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" fragmentSource "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","template-string"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\n  uniform vec4 u_color;\n\n  void main() {\n    gl_FragColor = u_color;\n  }\n  "}]},{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 创建 shader（整个 runtime 只需要创建一次）"}]},{"type":"text","value":"\nShader"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"create"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"demo\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" vertexSource"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" fragmentSource"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 创建自定义材质"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" material "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Material"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"engine"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Shader"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"find"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"demo\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Shader.create()"}]},{"type":"text","value":"用来将 shader 添加到引擎的缓存池子中，因此整个 runtime 只需要创建一次,接下来就可以通过 "},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.shader.html#find"},"children":[{"type":"text","value":"Shader.find(name)"}]},{"type":"text","value":" 来反复使用.\n"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"注：引擎已经预先 create 了 blinn-phong、pbr、shadow-map、shadow、skybox、framebuffer-picker-color、trail。用户可以直接使用这些内置 shader，但是不能重名创建。"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"因为我们没有上传 "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"u_color"}]},{"type":"text","value":"  变量，所以片元输出还是黑色的(uniform 默认值)，接下来我们来介绍下引擎内置的 shader 变量以及如何上传自定义变量。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"内置-shader-变量","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%E5%86%85%E7%BD%AE-shader-%E5%8F%98%E9%87%8F","ariaLabel":"内置 shader 变量 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"内置 shader 变量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在上面，我们给 material 赋予了 shader，这个时候程序已经可以开始渲染了。需要注意的是，shader 代码中有两种变量，一种是"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"逐顶点"}]},{"type":"text","value":"的 "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"attribute"}]},{"type":"text","value":" 变量，另一种是"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"逐 shader"}]},{"type":"text","value":" 的 "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"uniform"}]},{"type":"text","value":" 变量。(在 GLSL300 后，统一为 in 变量)\n引擎已经自动上传了一些常用变量，用户可以直接在 shader 代码中使用，如顶点数据和 mvp 数据，下面是引擎默认上传的变量。"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tagName":"table","properties":{},"children":[{"type":"element","tagName":"thead","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"th","properties":{"align":"left"},"children":[{"type":"text","value":"逐顶点数据"}]},{"type":"element","tagName":"th","properties":{"align":"left"},"children":[{"type":"text","value":"attribute name"}]},{"type":"element","tagName":"th","properties":{"align":"left"},"children":[{"type":"text","value":"数据类型"}]}]}]},{"type":"element","tagName":"tbody","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"顶点"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"POSITION"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"vec3"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"法线"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"NORMAL"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"vec3"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"切线"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"TANGENT"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"vec4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"顶点颜色"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"COLOR_0"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"vec4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"骨骼索引"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"JOINTS_0"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"vec4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"骨骼权重"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"WEIGHTS_0"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"vec4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"第一套纹理坐标"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"TEXCOORD_0"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"vec2"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"第二套纹理坐标"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"TEXCOORD_1"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"vec2"}]}]}]}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tagName":"table","properties":{},"children":[{"type":"element","tagName":"thead","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"th","properties":{"align":"left"},"children":[{"type":"text","value":"逐 shader 数据"}]},{"type":"element","tagName":"th","properties":{"align":"left"},"children":[{"type":"text","value":"uniform name"}]},{"type":"element","tagName":"th","properties":{"align":"left"},"children":[{"type":"text","value":"数据类型"}]}]}]},{"type":"element","tagName":"tbody","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"canvas 分辨率"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_resolution"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"vec2"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"视口矩阵"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_viewMat"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"投影矩阵"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_projMat"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"视口投影矩阵"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_VPMat"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"视口逆矩阵"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_viewInvMat"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"投影逆矩阵"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_projInvMat"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"相机位置"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_cameraPos"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"vec3"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"模型本地坐标系矩阵"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_localMat"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"模型世界坐标系矩阵"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_modelMat"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"模型视口矩阵"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_MVMat"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"模型视口投影矩阵"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_MVPMat"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"模型视口逆矩阵"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_MVInvMat"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"法线逆转置矩阵"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"u_normalMat"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"上传-shader-变量","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%E4%B8%8A%E4%BC%A0-shader-%E5%8F%98%E9%87%8F","ariaLabel":"上传 shader 变量 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"上传 shader 变量"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"attribute 逐顶点数据的上传请参考 "},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.manual%7Dcomponent/geometry-renderer.md"},"children":[{"type":"text","value":"几何体渲染器"}]},{"type":"text","value":",这里不再赘述。"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"除了内置的变量，我们可以在 shader 中上传任何自定义名字的变量(建议使用 u"},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"** 、 v"}]},{"type":"text","value":"** 分别表示 uniform、varying变量)，我们唯一要做的就是根据 shader 的变量类型，使用正确的接口。\n上传接口全部保存在 "},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.shaderdata.html"},"children":[{"type":"text","value":"ShaderData"}]},{"type":"text","value":" 中，而 shaderData 实例对象又分别保存在引擎的四大类 "},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.scene.html"},"children":[{"type":"text","value":"Scene"}]},{"type":"text","value":"、"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.camera.html"},"children":[{"type":"text","value":"Camera"}]},{"type":"text","value":"、"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.renderer.html"},"children":[{"type":"text","value":"Renderer"}]},{"type":"text","value":"、"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.material.html"},"children":[{"type":"text","value":"Material"}]},{"type":"text","value":" 中，我们只需要分别往这些 shaderData 中调用接口，上传变量，引擎便会在底层自动帮我们组装这些数据，并进行判重等性能的优化。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://gw.alipayobjects.com/mdn/rms_d27172/afts/img/A*yR97QbVx-QwAAAAAAAAAAAAAARQnAQ"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"shaderdata-分开的好处","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#shaderdata-%E5%88%86%E5%BC%80%E7%9A%84%E5%A5%BD%E5%A4%84","ariaLabel":"shaderdata 分开的好处 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"shaderData 分开的好处"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"shaderData 分别保存在引擎的四大类 "},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.scene.html"},"children":[{"type":"text","value":"Scene"}]},{"type":"text","value":"、"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.camera.html"},"children":[{"type":"text","value":"Camera"}]},{"type":"text","value":"、"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.renderer.html"},"children":[{"type":"text","value":"Renderer"}]},{"type":"text","value":"、"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.material.html"},"children":[{"type":"text","value":"Material"}]},{"type":"text","value":" 中，这样做的好处之一就是底层可以根据上传时机上传某一块 uniform，提升性能；另外，将材质无关的 shaderData 剥离出来，可以实现共享材质，比如两个 renderer ，共享了一个材质，虽然都要操控同一个 shader，但是因为这一部分 shader 数据的上传来源于两个 renderer 的 shaderData，所以是不会影响彼此的渲染结果的。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"typescript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-typescript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-typescript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" renderer1ShaderData "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" renderer1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"shaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" renderer2ShaderData "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" renderer2"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"shaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" materialShaderData "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" material"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"shaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\nmaterialShaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setColor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_color\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Color"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nrenderer1ShaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setFloat"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_progross\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0.5"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nrenderer2ShaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setFloat"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_progross\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0.8"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"调用接口","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3","ariaLabel":"调用接口 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"调用接口"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"shader 中变量的类型和调用的接口对应关系如下:"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tagName":"table","properties":{},"children":[{"type":"element","tagName":"thead","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"th","properties":{"align":"left"},"children":[{"type":"text","value":"shader 类型"}]},{"type":"element","tagName":"th","properties":{"align":"left"},"children":[{"type":"text","value":"ShaderData API"}]},{"type":"element","tagName":"th","properties":{"align":"left"},"children":[]}]}]},{"type":"element","tagName":"tbody","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"bool 、 int"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"setInt( value: number )"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"float"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"setFloat( value: number )"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"bvec2、ivec2、vec2"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"setVector2( value:Vector2 )"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"bvec3、ivec3、vec3"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"setVector3( value:Vector3 )"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"bvec4、ivec4、vec4"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"setVector4( value:Vector4 )"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"mat4"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"setMatrix( value:Matrix )"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"float[] 、vec2[] 、vec3[]、 vec4[] 、mat4[]"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"setFloatArray( value:Float32Array )"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"bool[]、 int[] 、bvec2[]、 bvec3[] 、bvec4[]、 ivec2[]、 ivec3[] 、ivec4[]"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"setIntArray( value:Int32Array )"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"sampler2D 、 samplerCube"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"setTexture( value:Texture )"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"sampler2D[] 、 samplerCube[]"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[{"type":"text","value":"setTextureArray( value:Texture[] )"}]},{"type":"element","tagName":"td","properties":{"align":"left"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"代码演示如下："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"// shader\n\nuniform float u_float;\nuniform int u_int;\nuniform bool u_bool;\nuniform vec2 u_vec2;\nuniform vec3 u_vec3;\nuniform vec4 u_vec4;\nuniform mat4 u_matrix;\nuniform int u_intArray[10];\nuniform float u_floatArray[10];\nuniform sampler2D u_sampler2D;\nuniform samplerCube u_samplerCube;\nuniform sampler2D u_samplerArray[2];\n\n// GLSL 300:\n// in float u_float; \n// ..."}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"typescript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-typescript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-typescript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// shaderData 可以分别保存在 scene 、camera 、renderer、 material 中。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" shaderData "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" material"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"shaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setFloat"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_float\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1.5"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setInt"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_int\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setInt"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_bool\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setVector2"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_vec2\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Vector2"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setVector3"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_vec3\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Vector3"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setVector4"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_vec4\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Vector4"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setMatrix"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_matrix\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Matrix"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setIntArray"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_intArray\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Int32Array"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setFloatArray"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_floatArray\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Float32Array"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setTexture"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_sampler2D\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" texture2D"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setTexture"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_samplerCube\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"textureCube"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setTextureArray"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_samplerArray\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"texture2D"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"textureCube"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"注：为了性能考虑，引擎暂不支持 结构体数组上传、数组单个元素上传。"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"宏开关","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%E5%AE%8F%E5%BC%80%E5%85%B3","ariaLabel":"宏开关 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"宏开关"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"除了uniform 变量之外，引擎将 shader 中的"},{"type":"element","tagName":"a","properties":{"href":"https://www.wikiwand.com/en/OpenGL_Shading_Language"},"children":[{"type":"text","value":"宏定义"}]},{"type":"text","value":"也视为一种变量，因为宏定义的开启/关闭 将生成不同的着色器变种，也会影响渲染结果。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如 shader 中有这些宏相关的操作："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"#ifdef DISCARD\n\tdiscard;\n#endif\n\n#ifdef LIGHT_COUNT\n\tuniform vec4 u_color[ LIGHT_COUNT ];\n#endif"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"也是通过 "},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.shader.html#enableMacro"},"children":[{"type":"text","value":"ShaderData"}]},{"type":"text","value":" 来操控宏变量："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"typescript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-typescript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-typescript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 开启宏开关"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"enableMacro"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"DISCARD\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 关闭宏开关"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"disableMacro"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"DISCARD\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 开启变量宏"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"enableMacro"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"LIGHT_COUNT\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"3\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 切换变量宏。这里底层会自动 disable 上一个宏，即 “LIGHT_COUNT 3”"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"enableMacro"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"LIGHT_COUNT\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"2\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 关闭变量宏"}]},{"type":"text","value":"\nshaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"disableMacro"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"LIGHT_COUNT\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"渲染状态","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%E6%B8%B2%E6%9F%93%E7%8A%B6%E6%80%81","ariaLabel":"渲染状态 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"渲染状态"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"我们通过材质的 shader，四块 shaderData 决定了材质的渲染表现。但是渲染管线除了着色器的操作，还提供了一些渲染状态来使我们对可编程的输入输出进行一些额外配置和处理。\n因此，引擎提供了"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.renderstate-1.html"},"children":[{"type":"text","value":"RenderState"}]},{"type":"text","value":" ，可以分别对"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.renderstate-1.html#blendstate"},"children":[{"type":"text","value":"混合状态（BlendState）"}]},{"type":"text","value":"、"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.renderstate-1.html#depthstate"},"children":[{"type":"text","value":"深度状态（DepthState）"}]},{"type":"text","value":"、"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.renderstate-1.html#stencilstate"},"children":[{"type":"text","value":"模版状态（StencilState）"}]},{"type":"text","value":"、"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.renderstate-1.html#rasterstate"},"children":[{"type":"text","value":"光栅状态（RasterState）"}]},{"type":"text","value":"进行配置。\n我们拿一个透明物体的标准渲染流程来举例，我们希望开启混合模式并设置混合因子，并且因为透明物体是叠加渲染的，所以我们还要关闭深度写入;"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"typescript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-typescript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-typescript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" renderState "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" material"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"renderState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 1. 设置颜色混合因子。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" blendState "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" renderState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"blendState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" target "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" blendState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"targetBlendState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// src 混合因子为（As，As，As，As）"}]},{"type":"text","value":"\ntarget"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"sourceColorBlendFactor "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" target"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"sourceAlphaBlendFactor "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"BlendFactor"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"SourceAlpha"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// dst 混合因子为（1 - As，1 - As，1 - As，1 - As）。"}]},{"type":"text","value":"\ntarget"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"destinationColorBlendFactor "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" target"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"destinationAlphaBlendFactor "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" BlendFactor"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"OneMinusSourceAlpha"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 操作方式为 src + dst  */"}]},{"type":"text","value":"\ntarget"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"colorBlendOperation "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" target"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"alphaBlendOperation "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" BlendOperation"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"Add"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 2. 关闭深度写入。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" depthState "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" renderState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"depthState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\ndepthState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"writeEnabled "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"false"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// 3. 设置透明渲染队列 （后面会讲为什么）"}]},{"type":"text","value":"\nmaterial"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"renderQueueType "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" RenderQueueType"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"Transparent"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"有关渲染状态的更多选项可以分别查看相应的"},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Dclasses/core.renderstate-1.html"},"children":[{"type":"text","value":"API 文档"}]},{"type":"text","value":" "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"渲染队列","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%E6%B8%B2%E6%9F%93%E9%98%9F%E5%88%97","ariaLabel":"渲染队列 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"渲染队列"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"至此，自定义材质已经非常完善了，但是也许我们还需要对物体的渲染顺序做一些处理，比如透明物体的渲染一般都是放在非透明队列后面的，因此，引擎提供了 "},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Denums/core.renderqueuetype.html"},"children":[{"type":"text","value":"渲染队列（RenderQueueType）"}]},{"type":"text","value":" ，我们设置材质的渲染队列，可以决定这个材质在当前场景中的渲染顺序，引擎底层会对不同范围的渲染队列进行一些特殊处理，如 "},{"type":"element","tagName":"a","properties":{"href":"$%7Bbook.api%7Denums/core.renderqueuetype.html#transparent"},"children":[{"type":"text","value":"RenderQueueType.Transparent"}]},{"type":"text","value":" 会从远到近进行渲染。值得注意的是渲染队列的值可以是枚举值加上任何自定义数字。"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"typescript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-typescript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-typescript"]},"children":[{"type":"text","value":"material"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"renderQueueType "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" RenderQueueType"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"Opaque "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"封装自定义材质","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%E5%B0%81%E8%A3%85%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%90%E8%B4%A8","ariaLabel":"封装自定义材质 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"封装自定义材质"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这部分的内容是结合上文所有内容，给用户一个简单的封装示例，希望对您有所帮助："}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"typescript"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-typescript"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-typescript"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" Material"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Shader"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Color"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Texture2D"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" BlendFactor"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" RenderQueueType "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"oasis-engine\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"//-- Shader 代码"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" vertexSource "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","template-string"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\n  uniform mat4 u_MVPMat;\n\n  attribute vec3 POSITION; \n  attribute vec2 TEXCOORD_0;\n  varying vec2 v_uv;\n\n  void main() {\n    gl_Position = u_MVPMat * vec4(POSITION, 1.0);\n    v_uv = TEXCOORD_0;\n  }\n  "}]},{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" fragmentSource "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","template-string"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\n  uniform vec4 u_color;\n  varying vec2 v_uv;\n\n  #ifdef TEXTURE\n    uniform sampler2D u_texture;\n  #endif\n\n  void main() {\n    vec4 color = u_color;\n\n    #ifdef TEXTURE\n      color *= texture2D(u_texture, v_uv);\n    #endif\n\n    gl_FragColor = color;\n\n  }\n  "}]},{"type":"element","tagName":"span","properties":{"className":["token","template-punctuation","string"]},"children":[{"type":"text","value":"`"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\nShader"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"create"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"demo\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"vertexSource"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"fragmentSource"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CustomMaterial"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"extends"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Material"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"set"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"texture"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"value"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Texture2D"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"value"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"shaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"enableMacro"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"TEXTURE\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"shaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setTexture"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_texture\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" value"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"else"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"shaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"disableMacro"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"TEXTURE\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"set"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"color"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"val"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"Color"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"shaderData"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setColor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"u_color\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" val"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// make it transparent"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"set"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"transparent"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" target "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"renderState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"blendState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"targetBlendState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" depthState "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"renderState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"depthState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    target"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"sourceColorBlendFactor "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" target"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"sourceAlphaBlendFactor "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" BlendFactor"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"SourceAlpha"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    target"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"destinationColorBlendFactor "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" target"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"destinationAlphaBlendFactor "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" BlendFactor"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"OneMinusSourceAlpha"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    depthState"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"writeEnabled "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"false"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"renderQueueType "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" RenderQueueType"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"Transparent"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"constructor"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"engine"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"Engine"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"super"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"engine"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Shader"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"find"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"demo\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]}],"data":{"quirksMode":false}},"tableOfContents":"<ul>\n<li><a href=\"/docs/custom-material-cn/#%E5%88%9B%E5%BB%BA-shader\">创建 shader</a></li>\n<li><a href=\"/docs/custom-material-cn/#%E5%86%85%E7%BD%AE-shader-%E5%8F%98%E9%87%8F\">内置 shader 变量</a></li>\n<li>\n<p><a href=\"/docs/custom-material-cn/#%E4%B8%8A%E4%BC%A0-shader-%E5%8F%98%E9%87%8F\">上传 shader 变量</a></p>\n<ul>\n<li><a href=\"/docs/custom-material-cn/#shaderdata-%E5%88%86%E5%BC%80%E7%9A%84%E5%A5%BD%E5%A4%84\">shaderData 分开的好处</a></li>\n<li><a href=\"/docs/custom-material-cn/#%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3\">调用接口</a></li>\n<li><a href=\"/docs/custom-material-cn/#%E5%AE%8F%E5%BC%80%E5%85%B3\">宏开关</a></li>\n</ul>\n</li>\n<li><a href=\"/docs/custom-material-cn/#%E6%B8%B2%E6%9F%93%E7%8A%B6%E6%80%81\">渲染状态</a></li>\n<li><a href=\"/docs/custom-material-cn/#%E6%B8%B2%E6%9F%93%E9%98%9F%E5%88%97\">渲染队列</a></li>\n<li><a href=\"/docs/custom-material-cn/#%E5%B0%81%E8%A3%85%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%90%E8%B4%A8\">封装自定义材质</a></li>\n</ul>","frontmatter":{"title":"自定义材质","order":4,"type":"资源系统"},"fields":{"path":"/docs/custom-material.zh-CN.md","slug":"/docs/custom-material-cn","modifiedTime":1620457782397,"avatarList":"[]"}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":"图片显示","order":11,"type":"组件","time":null},"fields":{"slug":"/docs/sprite-renderer-cn","path":"/docs/sprite-renderer.zh-CN.md"}}},{"node":{"frontmatter":{"title":"射线投射","order":10,"type":"组件","time":null},"fields":{"slug":"/docs/ray-cn","path":"/docs/ray.zh-CN.md"}}},{"node":{"frontmatter":{"title":"碰撞检测","order":9,"type":"组件","time":null},"fields":{"slug":"/docs/collision-cn","path":"/docs/collision.zh-CN.md"}}},{"node":{"frontmatter":{"title":"粒子动画","order":8,"type":"组件","time":null},"fields":{"slug":"/docs/particle-renderer-cn","path":"/docs/particle-renderer.zh-CN.md"}}},{"node":{"frontmatter":{"title":"骨骼动画","order":7,"type":"组件","time":null},"fields":{"slug":"/docs/skeletal-animation-cn","path":"/docs/skeletal-animation.zh-CN.md"}}},{"node":{"frontmatter":{"title":"迁移 antd@4 指南","order":6,"type":"Blog","time":"2020-01-16T00:00:00.000Z"},"fields":{"slug":"/blog/antd-4.0-cn","path":"/blog/antd-4.0.zh-CN.md"}}},{"node":{"frontmatter":{"title":"脚本组件","order":6,"type":"组件","time":null},"fields":{"slug":"/docs/script-cn","path":"/docs/script.zh-CN.md"}}},{"node":{"frontmatter":{"title":"克隆","order":5,"type":"核心","time":null},"fields":{"slug":"/docs/entity-clone-cn","path":"/docs/entity-clone.zh-CN.md"}}},{"node":{"frontmatter":{"title":"基础几何体渲染器","order":5,"type":"组件","time":null},"fields":{"slug":"/docs/basic-geometry-cn","path":"/docs/basic-geometry.zh-CN.md"}}},{"node":{"frontmatter":{"title":"实体","order":4,"type":"核心","time":null},"fields":{"slug":"/docs/entity-cn","path":"/docs/entity.zh-CN.md"}}},{"node":{"frontmatter":{"title":"自定义几何体渲染器","order":4,"type":"组件","time":null},"fields":{"slug":"/docs/geometry-renderer-cn","path":"/docs/geometry-renderer.zh-CN.md"}}},{"node":{"frontmatter":{"title":"自定义材质","order":4,"type":"资源系统","time":null},"fields":{"slug":"/docs/custom-material-cn","path":"/docs/custom-material.zh-CN.md"}}},{"node":{"frontmatter":{"title":"事件系统","order":3,"type":"工具库","time":null},"fields":{"slug":"/docs/event-cn","path":"/docs/event.zh-CN.md"}}},{"node":{"frontmatter":{"title":"场景","order":3,"type":"核心","time":null},"fields":{"slug":"/docs/scene-cn","path":"/docs/scene.zh-CN.md"}}},{"node":{"frontmatter":{"title":"灯光","order":3,"type":"组件","time":null},"fields":{"slug":"/docs/light-cn","path":"/docs/light.zh-CN.md"}}},{"node":{"frontmatter":{"title":"材质","order":3,"type":"资源系统","time":null},"fields":{"slug":"/docs/material-cn","path":"/docs/material.zh-CN.md"}}},{"node":{"frontmatter":{"title":"帧缓冲拾取","order":2,"type":"二方库","time":null},"fields":{"slug":"/docs/framebuffer-picker-cn","path":"/docs/framebuffer-picker.zh-CN.md"}}},{"node":{"frontmatter":{"title":"绘制一个 3D 模型","order":2,"type":"入门","time":null},"fields":{"slug":"/docs/model-cn","path":"/docs/model.zh-CN.md"}}},{"node":{"frontmatter":{"title":"引擎状态面板","order":2,"type":"工具库","time":null},"fields":{"slug":"/docs/stats-cn","path":"/docs/stats.zh-CN.md"}}},{"node":{"frontmatter":{"title":"屏幕适配","order":2,"type":"核心","time":null},"fields":{"slug":"/docs/screen-fit-cn","path":"/docs/screen-fit.zh-CN.md"}}},{"node":{"frontmatter":{"title":"相机","order":2,"type":"组件","time":null},"fields":{"slug":"/docs/camera-cn","path":"/docs/camera.zh-CN.md"}}},{"node":{"frontmatter":{"title":"纹理资源","order":2,"type":"资源系统","time":null},"fields":{"slug":"/docs/texture-cn","path":"/docs/texture.zh-CN.md"}}},{"node":{"frontmatter":{"title":"控制器","order":1,"type":"二方库","time":null},"fields":{"slug":"/docs/controls-cn","path":"/docs/controls.zh-CN.md"}}},{"node":{"frontmatter":{"title":"绘制一个立方体","order":1,"type":"入门","time":null},"fields":{"slug":"/docs/cube-cn","path":"/docs/cube.zh-CN.md"}}},{"node":{"frontmatter":{"title":"数学库","order":1,"type":"工具库","time":null},"fields":{"slug":"/docs/math-cn","path":"/docs/math.zh-CN.md"}}},{"node":{"frontmatter":{"title":"引擎","order":1,"type":"核心","time":null},"fields":{"slug":"/docs/engine-cn","path":"/docs/engine.zh-CN.md"}}},{"node":{"frontmatter":{"title":"变换组件","order":1,"type":"组件","time":null},"fields":{"slug":"/docs/transform-cn","path":"/docs/transform.zh-CN.md"}}},{"node":{"frontmatter":{"title":"资源管理与加载","order":1,"type":"资源系统","time":null},"fields":{"slug":"/docs/resource-manager-cn","path":"/docs/resource-manager.zh-CN.md"}}}]}},"pageContext":{"slug":"/docs/custom-material-cn","type":"/docs/","locale":"/-cn/"}},"staticQueryHashes":[]}