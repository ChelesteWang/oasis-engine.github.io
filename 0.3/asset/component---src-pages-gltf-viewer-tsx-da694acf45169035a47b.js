(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"2m7x":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var i=n("5+eA"),o=n("gTpR"),s=n("qSBo"),a=n("xwgP"),r=n.n(a),l=n("Ac47"),c=(n("Qr5y"),{sky:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*Gi7CTZqKuacAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*iRRMQIExwKMAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*ZIcPQZo20sAAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*SPYuTbHT-KgAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*mGUERbY77roAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*ilkPS7A1_JsAAAAAAAAAAABkARQnAQ"],house:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*1gjTQ7P2mQoAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*entSR7DylL0AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*izQBQY_vs_4AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*x3XnRpq1U-EAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*k7FsT5Gprn0AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*8LdBQ6ixiQAAAAAAAAAAAABkARQnAQ"],sunnyDay:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*4ZY8T4GpKwYAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*8QbJQZwS1wUAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*a54kSZ3LmAQAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*8CbfTb1yG8MAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*Yi4ZRZbdj8MAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*KddxSriLYjoAAAAAAAAAAABkARQnAQ"],miniSampler:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*IuyGR4bdwg4AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*4rv5RZ0kll4AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*cHitTpWoJjoAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*RCEbS6k5x18AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*IRc7R7cl4CcAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*y_4hRYVgzQ4AAAAAAAAAAABkARQnAQ"]}),A=function(){function e(){var t=this;this.cubeTextures={},this.textures={},this.engine=new s.WebGLEngine("canvas-gltf-viewer",{alpha:!0}),this.scene=this.engine.sceneManager.activeScene,this.rootEntity=this.scene.createRootEntity("root"),this.cameraEntity=this.rootEntity.createChild("camera"),this.gltfRootEntity=this.rootEntity.createChild("gltf"),this.pointLightEntity1=this.rootEntity.createChild("point_light1"),this.pointLightEntity2=this.rootEntity.createChild("point_light2"),this.camera=this.cameraEntity.addComponent(s.Camera),this.controler=this.cameraEntity.addComponent(o.OrbitControl),this.envLight=this.rootEntity.addComponent(s.EnvironmentMapLight),this.pointLight1=this.pointLightEntity1.addComponent(s.PointLight),this.pointLight2=this.pointLightEntity2.addComponent(s.PointLight),this.skybox=this.rootEntity.addComponent(s.SkyBox),this.gui=new window.dat.GUI,this.materialFolder=null,this.animationFolder=null,this.state={background:!1,envTexture:"miniSampler",envIntensity:1,addLights:!0,lightColor:e.colorToGui(new s.Color(1,1,1)),lightIntensity:.8},this._materials=[],this._boundingBox=new s.BoundingBox,this._center=new s.Vector3,this._extent=new s.Vector3,this.$spinner=document.getElementById("spinner"),this.$dropZone=document.getElementById("dropZone"),this.$input=document.getElementById("input"),this.$close=document.getElementById("close"),this.initResources().then((function(){t.initScene(),t.initDropZone(),t.addSceneGUI(),t.initDefaultDebugMesh()}))}e.guiToColor=function(e,t){t.setValue(e[0]/255,e[1]/255,e[2]/255,t.a)},e.colorToGui=function(e){void 0===e&&(e=new s.Color(1,1,1));var t=[];return t[0]=255*e.r,t[1]=255*e.g,t[2]=255*e.b,t};var t=e.prototype;return t.initResources=function(){var e=this,t=Object.keys(c);return new Promise((function(n){e.engine.resourceManager.load(t.map((function(e){return{type:s.AssetType.TextureCube,urls:c[e]}}))).then((function(i){i.forEach((function(n,i){var o=t[i];e.cubeTextures[o]=n,o===e.state.envTexture&&(e.envLight.specularTexture=n,e.skybox.skyBoxMap=n)})),n(!0)}))}))},t.initScene=function(){this.engine.canvas.resizeByClientSize(),this.controler.minDistance=0,this.state.background||(this.skybox.enabled=!1),this.state.addLights||(this.pointLight1.enabled=!1,this.pointLight2.enabled=!1),this.pointLight1.intensity=this.state.lightIntensity,this.pointLight2.intensity=this.state.lightIntensity,this.envLight.specularIntensity=this.state.envIntensity,this.camera.backgroundColor=new s.Vector4(0,0,0,0),this.engine.run()},t.addSceneGUI=function(){var t=this,n=this.gui,o=n.addFolder("Scene");o.add(this.state,"background").onChange((function(e){t.skybox.enabled=e}));var s=n.addFolder("Lighting");s.add(this.state,"envTexture",["None"].concat(Object(i.a)(Object.keys(this.cubeTextures)))).name("IBL").onChange((function(e){t.envLight.specularTexture=t.skybox.skyBoxMap="None"===e?null:t.cubeTextures[e]})),s.add(this.state,"envIntensity",0,2).onChange((function(e){t.envLight.specularIntensity=e})).name("间接光强度"),s.add(this.state,"addLights").onChange((function(e){t.pointLight1.enabled=e,t.pointLight2.enabled=e})).name("直接光"),s.addColor(this.state,"lightColor").onChange((function(n){e.guiToColor(n,t.pointLight1.color),e.guiToColor(n,t.pointLight2.color)})),s.add(this.state,"lightIntensity",0,2).onChange((function(e){t.pointLight1.intensity=e,t.pointLight2.intensity=e})).name("直接光强度"),o.open(),s.open()},t.initDefaultDebugMesh=function(){var e=s.PrimitiveMesh.createSphere(this.engine,5,64),t=new s.PBRMaterial(this.engine);t.metallicFactor=0,t.roughnessFactor=0,t.name="default";var n=this.gltfRootEntity.addComponent(s.MeshRenderer);n.mesh=e,n.setMaterial(t),this.loadMaterialGUI([t]),this.setCenter([n])},t.setCenter=function(e){var t=this._boundingBox,n=this._center,i=this._extent;t.min.setValue(0,0,0),t.max.setValue(0,0,0),e.forEach((function(e){s.BoundingBox.merge(e.bounds,t,t)})),t.getExtent(i);var o=i.length();t.getCenter(n),this.controler.target.setValue(n.x,n.y,n.z),this.cameraEntity.transform.setPosition(n.x,n.y,3*o),this.camera.farClipPlane=12*o,this.controler.maxDistance=10*o,this.pointLightEntity1.transform.setPosition(0,3*o,3*o),this.pointLightEntity2.transform.setPosition(0,3*-o,3*-o)},t.initDropZone=function(){var e=this;new window.SimpleDropzone.SimpleDropzone(document.body,this.$input).on("drop",(function(t){var n=t.files;return e.loadFileMaps(n)})),this.$close.onclick=function(){e.$dropZone.classList.add("hide")}},t.loadFileMaps=function(e){var t,n=this,i=/\.(gltf|glb)$/i,o=/\.(jpg|jpeg|png)$/i,s="gltf",a={},r=Array.from(e);if(r.some((function(e){var n=e[0],o=e[1];if(i.test(o.name))return s=RegExp.$1,t=o,n.replace(o.name,""),!0})),r.forEach((function(e){e[0];var t=e[1];if(!i.test(t.name)){var s=URL.createObjectURL(t),r=t.name;a[r]=s,o.test(r)&&n.addTexture(r,s)}})),t){this.dropStart();var l=URL.createObjectURL(t);this.loadModel(l,a,s)}},t.loadModel=function(e,t,n){var i=this;this.destoryGLTF(),"gltf"===n.toLowerCase()?this.engine.resourceManager.load({type:s.AssetType.JSON,url:e}).then((function(e){e.buffers.concat(e.images).forEach((function(e){if(e){var n=e.uri;t[n]&&(e.uri=t[n])}}));var n=new Blob([JSON.stringify(e)]),o=URL.createObjectURL(n);i.engine.resourceManager.load({type:s.AssetType.Perfab,url:o+"#.gltf"}).then((function(e){i.handleGltfResource(e)})).catch((function(){i.dropError()}))})):this.engine.resourceManager.load({type:s.AssetType.Perfab,url:e+"#.glb"}).then((function(e){i.handleGltfResource(e)})).catch((function(){i.dropError()}))},t.handleGltfResource=function(e){var t=e.defaultSceneRoot,n=e.materials,i=e.animations;console.log(e),this.dropSuccess(),this.gltfRootEntity=t,this.rootEntity.addChild(t);var o=[],a=[];t.getComponentsIncludeChildren(s.MeshRenderer,o),t.getComponentsIncludeChildren(s.SkinnedMeshRenderer,a),this.setCenter(o.concat(a)),this.loadMaterialGUI(n),this.loadAnimationGUI(i)},t.addTexture=function(e,t){var n=this;Object.keys(this.textures).find((function(t){return t===e}))?console.warn(e+" 已经存在，请更换图片名字重新上传"):this.engine.resourceManager.load({type:s.AssetType.Texture2D,url:t}).then((function(t){n.textures[e]=t,n.loadMaterialGUI(),console.log("图片上传成功！",e)}))},t.dropStart=function(){this.$dropZone.classList.add("hide"),this.$spinner.classList.remove("hide")},t.dropError=function(){this.$dropZone.classList.remove("hide"),this.$spinner.classList.add("hide")},t.dropSuccess=function(){this.$dropZone.classList.add("hide"),this.$spinner.classList.add("hide")},t.destoryGLTF=function(){this.gltfRootEntity.destroy()},t.loadMaterialGUI=function(t){var n=this,o=this.gui;if(this.materialFolder&&(o.removeFolder(this.materialFolder),this.materialFolder=null),t||(t=this._materials),this._materials=t,t.length){var a=this.materialFolder=o.addFolder("Material"),r={};t.forEach((function(t){if(t instanceof s.PBRBaseMaterial||t instanceof s.UnlitMaterial){t.name||(t.name="default");var o={baseColor:e.colorToGui(t.baseColor),emissiveColor:e.colorToGui(t.emissiveColor),specularColor:e.colorToGui(t.specularColor),baseTexture:t.baseTexture?"origin":"",metallicRoughnessTexture:t.metallicRoughnessTexture?"origin":"",normalTexture:t.normalTexture?"origin":"",emissiveTexture:t.emissiveTexture?"origin":"",occlusionTexture:t.occlusionTexture?"origin":"",opacityTexture:t.opacityTexture?"origin":"",specularGlossinessTexture:t.specularGlossinessTexture?"origin":""},l={baseTexture:t.baseTexture,metallicRoughnessTexture:t.metallicRoughnessTexture,normalTexture:t.normalTexture,emissiveTexture:t.emissiveTexture,occlusionTexture:t.occlusionTexture,opacityTexture:t.opacityTexture,specularGlossinessTexture:t.specularGlossinessTexture},c=a.addFolder(r[t.name]?t.name+"_"+(r[t.name]+1):t.name);if(r[t.name]=null==r[t.name]?1:r[t.name]+1,t instanceof s.PBRMaterial){var A=c.addFolder("金属模式");A.add(t,"metallicFactor",0,1).step(.01),A.add(t,"roughnessFactor",0,1).step(.01),A.add(o,"metallicRoughnessTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.metallicRoughnessTexture="None"===e?null:n.textures[e]||l.metallicRoughnessTexture})),A.open()}else if(t instanceof s.PBRSpecularMaterial){var u=c.addFolder("高光模式");u.add(t,"glossinessFactor",0,1).step(.01),u.addColor(o,"specularColor").onChange((function(n){e.guiToColor(n,t.specularColor)})),u.add(o,"specularGlossinessTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.specularGlossinessTexture="None"===e?null:n.textures[e]||l.specularGlossinessTexture})),u.open()}else t instanceof s.UnlitMaterial&&(c.add(o,"baseTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.baseTexture="None"===e?null:n.textures[e]||l.baseTexture})),c.addColor(o,"baseColor").onChange((function(n){e.guiToColor(n,t.baseColor)})));if(!(t instanceof s.UnlitMaterial)){var d=c.addFolder("通用");d.add(t,"envMapIntensity",0,2).step(.01),d.add(t,"opacity",0,1).step(.01).onChange((function(e){return o.baseColor[3]=e})),d.add(t,"isTransparent"),d.add(t,"alphaCutoff",0,1).step(.01),d.add(t,"getOpacityFromRGB"),d.addColor(o,"baseColor").onChange((function(n){e.guiToColor(n,t.baseColor)})).listen(),d.addColor(o,"emissiveColor").onChange((function(n){e.guiToColor(n,t.emissiveColor)})),d.add(o,"baseTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.baseTexture="None"===e?null:n.textures[e]||l.baseTexture})),d.add(o,"normalTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.normalTexture="None"===e?null:n.textures[e]||l.normalTexture})),d.add(o,"emissiveTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.emissiveTexture="None"===e?null:n.textures[e]||l.emissiveTexture})),d.add(o,"occlusionTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.occlusionTexture="None"===e?null:n.textures[e]||l.occlusionTexture})),d.add(o,"opacityTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.opacityTexture="None"===e?null:n.textures[e]||l.opacityTexture})),d.open()}}})),a.open()}},t.loadAnimationGUI=function(e){if(this.animationFolder&&(this.gui.removeFolder(this.animationFolder),this.animationFolder=null),null!=e&&e.length){this.animationFolder=this.gui.addFolder("Animation"),this.animationFolder.open();var t=this.gltfRootEntity.getComponent(s.Animation);t.playAnimationClip(e[0].name);var n={animation:e[0].name};this.animationFolder.add(n,"animation",["None"].concat(Object(i.a)(e.map((function(e){return e.name}))))).onChange((function(e){"None"===e?t.stop(!0):t.playAnimationClip(e)}))}},e}();function u(e){return Object(a.useEffect)((function(){var e,t=[{dom:null,url:"https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"},{dom:null,url:"https://cdn.jsdelivr.net/npm/simple-dropzone@0.8.1/dist/simple-dropzone.umd.js"}];return Promise.all(t.map((function(e){return new Promise((function(t){var n=document.createElement("script");n.type="text/javascript",document.body.appendChild(n),n.onload=function(){t(void 0)},n.src=e.url,e.dom=n}))}))).then((function(){e=new A})),function(){e.engine.destroy(),e.gui.destroy(),t.forEach((function(e){document.body.removeChild(e.dom)}))}})),r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,e,r.a.createElement("div",{className:"page-gltf-view"},r.a.createElement("canvas",{id:"canvas-gltf-viewer",style:{width:"100%",height:"calc(100vh - 102px)"}}),r.a.createElement("input",{id:"input",type:"file",className:"hide"}),r.a.createElement("div",{id:"dropZone",className:"dropZone"},r.a.createElement("img",{id:"close",className:"closeIcon",src:"https://gw.alipayobjects.com/mdn/mybank_yul/afts/img/A*B7GAQq_VPyIAAAAAAAAAAABkARQnAQ",alt:""}),r.a.createElement("p",null,"拖拽 gltf 2.0 规范的文件或者文件夹到此页面进行预览"),r.a.createElement("p",null,"拖拽支持的图片或者文件夹到此页面，调试纹理贴图"),r.a.createElement("br",null),r.a.createElement("p",null,"模型格式支持:.gltf .glb .bin"),r.a.createElement("p",null,"贴图格式支持:.jpg .png")),r.a.createElement("div",{id:"spinner",className:"spinner hide"}),r.a.createElement("script",{type:"module",src:"./src/index.ts"}))))}},Qr5y:function(e,t,n){}}]);