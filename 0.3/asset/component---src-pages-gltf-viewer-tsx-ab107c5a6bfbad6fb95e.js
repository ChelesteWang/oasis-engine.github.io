(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"2m7x":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var i=n("5+eA"),s=n("xwgP"),o=n.n(s),a=n("Ac47"),r=n("gTpR"),A=n("qSBo"),c=(n("Qr5y"),{sky:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*Gi7CTZqKuacAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*iRRMQIExwKMAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*ZIcPQZo20sAAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*SPYuTbHT-KgAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*mGUERbY77roAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*ilkPS7A1_JsAAAAAAAAAAABkARQnAQ"],house:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*1gjTQ7P2mQoAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*entSR7DylL0AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*izQBQY_vs_4AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*x3XnRpq1U-EAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*k7FsT5Gprn0AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*8LdBQ6ixiQAAAAAAAAAAAABkARQnAQ"],sunnyDay:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*4ZY8T4GpKwYAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*8QbJQZwS1wUAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*a54kSZ3LmAQAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*8CbfTb1yG8MAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*Yi4ZRZbdj8MAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*KddxSriLYjoAAAAAAAAAAABkARQnAQ"],miniSampler:["https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*IuyGR4bdwg4AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*4rv5RZ0kll4AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*cHitTpWoJjoAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*RCEbS6k5x18AAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*IRc7R7cl4CcAAAAAAAAAAABkARQnAQ","https://gw.alipayobjects.com/mdn/rms_475770/afts/img/A*y_4hRYVgzQ4AAAAAAAAAAABkARQnAQ"]}),l=function(){function e(){var t=this;this.cubeTextures={},this.textures={},this.engine=new A.WebGLEngine("canvas-gltf-viewer",{alpha:!0}),this.scene=this.engine.sceneManager.activeScene,this.rootEntity=this.scene.createRootEntity("root"),this.cameraEntity=this.rootEntity.createChild("camera"),this.gltfRootEntity=this.rootEntity.createChild("gltf"),this.pointLightEntity1=this.rootEntity.createChild("point_light1"),this.pointLightEntity2=this.rootEntity.createChild("point_light2"),this.camera=this.cameraEntity.addComponent(A.Camera),this.controler=this.cameraEntity.addComponent(r.OrbitControl),this.envLight=this.rootEntity.addComponent(A.EnvironmentMapLight),this.pointLight1=this.pointLightEntity1.addComponent(A.PointLight),this.pointLight2=this.pointLightEntity2.addComponent(A.PointLight),this.skybox=this.rootEntity.addComponent(A.SkyBox),this.materialFolder=null,this.animationFolder=null,this.state={background:!1,envTexture:"miniSampler",envIntensity:1,addLights:!0,lightColor:e.colorToGui(new A.Color(1,1,1)),lightIntensity:.8},this._materials=[],this._boundingBox=new A.BoundingBox,this._center=new A.Vector3,this._extent=new A.Vector3,this.$spinner=document.getElementById("spinner"),this.$dropZone=document.getElementById("dropZone"),this.$input=document.getElementById("input"),this.$close=document.getElementById("close"),this.initResources().then((function(){t.initScene(),t.initDropZone(),t.addSceneGUI(),t.initDefaultDebugMesh()}))}e.colorToGui=function(e){void 0===e&&(e=new A.Color(1,1,1));var t=[];return t[0]=255*e.r,t[1]=255*e.g,t[2]=255*e.b,t};var t=e.prototype;return t.initResources=function(){var e=this,t=Object.keys(c);return new Promise((function(n){e.engine.resourceManager.load(t.map((function(e){return{type:A.AssetType.TextureCube,urls:c[e]}}))).then((function(i){i.forEach((function(n,i){var s=t[i];e.cubeTextures[s]=n,s===e.state.envTexture&&(e.envLight.specularTexture=n,e.skybox.skyBoxMap=n)})),n(!0)}))}))},t.initScene=function(){this.engine.canvas.resizeByClientSize(),this.controler.minDistance=0,this.state.background||(this.skybox.enabled=!1),this.state.addLights||(this.pointLight1.enabled=!1,this.pointLight2.enabled=!1),this.pointLight1.intensity=this.state.lightIntensity,this.pointLight2.intensity=this.state.lightIntensity,this.envLight.specularIntensity=this.state.envIntensity,this.camera.backgroundColor=new A.Vector4(0,0,0,0),this.engine.run()},t.addSceneGUI=function(){},t.initDefaultDebugMesh=function(){var e=A.PrimitiveMesh.createSphere(this.engine,5,64),t=new A.PBRMaterial(this.engine);t.metallicFactor=0,t.roughnessFactor=0,t.name="default";var n=this.gltfRootEntity.addComponent(A.MeshRenderer);n.mesh=e,n.setMaterial(t),this.loadMaterialGUI([t]),this.setCenter([n])},t.setCenter=function(e){var t=this._boundingBox,n=this._center,i=this._extent;t.min.setValue(0,0,0),t.max.setValue(0,0,0),e.forEach((function(e){A.BoundingBox.merge(e.bounds,t,t)})),t.getExtent(i);var s=i.length();t.getCenter(n),this.controler.target.setValue(n.x,n.y,n.z),this.cameraEntity.transform.setPosition(n.x,n.y,3*s),this.camera.farClipPlane=12*s,this.controler.maxDistance=10*s,this.pointLightEntity1.transform.setPosition(0,3*s,3*s),this.pointLightEntity2.transform.setPosition(0,3*-s,3*-s)},t.initDropZone=function(){},t.loadFileMaps=function(e){var t,n=this,i=/\.(gltf|glb)$/i,s=/\.(jpg|jpeg|png)$/i,o="gltf",a={},r=Array.from(e);if(r.some((function(e){var n=e[0],s=e[1];if(i.test(s.name))return o=RegExp.$1,t=s,n.replace(s.name,""),!0})),r.forEach((function(e){e[0];var t=e[1];if(!i.test(t.name)){var o=URL.createObjectURL(t),r=t.name;a[r]=o,s.test(r)&&n.addTexture(r,o)}})),t){this.dropStart();var A=URL.createObjectURL(t);this.loadModel(A,a,o)}},t.loadModel=function(e,t,n){var i=this;this.destoryGLTF(),"gltf"===n.toLowerCase()?this.engine.resourceManager.load({type:A.AssetType.JSON,url:e}).then((function(e){e.buffers.concat(e.images).forEach((function(e){if(e){var n=e.uri;t[n]&&(e.uri=t[n])}}));var n=new Blob([JSON.stringify(e)]),s=URL.createObjectURL(n);i.engine.resourceManager.load({type:A.AssetType.Perfab,url:s+"#.gltf"}).then((function(e){i.handleGltfResource(e)})).catch((function(){i.dropError()}))})):this.engine.resourceManager.load({type:A.AssetType.Perfab,url:e+"#.glb"}).then((function(e){i.handleGltfResource(e)})).catch((function(){i.dropError()}))},t.handleGltfResource=function(e){var t=e.defaultSceneRoot,n=e.materials,i=e.animations;this.dropSuccess(),this.gltfRootEntity=t,this.rootEntity.addChild(t);var s=[],o=[];t.getComponentsIncludeChildren(A.MeshRenderer,s),t.getComponentsIncludeChildren(A.SkinnedMeshRenderer,o),this.setCenter(s.concat(o)),this.loadMaterialGUI(n),this.loadAnimationGUI(i)},t.addTexture=function(e,t){var n=this;Object.keys(this.textures).find((function(t){return t===e}))||this.engine.resourceManager.load({type:A.AssetType.Texture2D,url:t}).then((function(t){n.textures[e]=t,n.loadMaterialGUI()}))},t.dropStart=function(){this.$dropZone.classList.add("hide"),this.$spinner.classList.remove("hide")},t.dropError=function(){this.$dropZone.classList.remove("hide"),this.$spinner.classList.add("hide")},t.dropSuccess=function(){this.$dropZone.classList.add("hide"),this.$spinner.classList.add("hide")},t.destoryGLTF=function(){this.gltfRootEntity.destroy()},t.loadMaterialGUI=function(t){var n=this;t||(t=this._materials),this._materials=t,t.length&&t.forEach((function(t){if(t instanceof A.PBRBaseMaterial||t instanceof A.UnlitMaterial){t.name||(t.name="default");var s={baseColor:e.colorToGui(t.baseColor),emissiveColor:e.colorToGui(t.emissiveColor),specularColor:e.colorToGui(t.specularColor),baseTexture:t.baseTexture?"origin":"",metallicRoughnessTexture:t.metallicRoughnessTexture?"origin":"",normalTexture:t.normalTexture?"origin":"",emissiveTexture:t.emissiveTexture?"origin":"",occlusionTexture:t.occlusionTexture?"origin":"",opacityTexture:t.opacityTexture?"origin":"",specularGlossinessTexture:t.specularGlossinessTexture?"origin":""},o={baseTexture:t.baseTexture,metallicRoughnessTexture:t.metallicRoughnessTexture,normalTexture:t.normalTexture,emissiveTexture:t.emissiveTexture,occlusionTexture:t.occlusionTexture,opacityTexture:t.opacityTexture,specularGlossinessTexture:t.specularGlossinessTexture};if(t instanceof A.PBRMaterial){var a=f.addFolder("金属模式");a.add(t,"metallicFactor",0,1).step(.01),a.add(t,"roughnessFactor",0,1).step(.01),a.add(s,"metallicRoughnessTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.metallicRoughnessTexture="None"===e?null:n.textures[e]||o.metallicRoughnessTexture})),a.open()}else if(t instanceof A.PBRSpecularMaterial){var r=f.addFolder("高光模式");r.add(t,"glossinessFactor",0,1).step(.01),r.addColor(s,"specularColor").onChange((function(n){e.guiToColor(n,t.specularColor)})),r.add(s,"specularGlossinessTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.specularGlossinessTexture="None"===e?null:n.textures[e]||o.specularGlossinessTexture})),r.open()}else t instanceof A.UnlitMaterial&&(f.add(s,"baseTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.baseTexture="None"===e?null:n.textures[e]||o.baseTexture})),f.addColor(s,"baseColor").onChange((function(n){e.guiToColor(n,t.baseColor)})));if(!(t instanceof A.UnlitMaterial)){var c=f.addFolder("通用");c.add(t,"envMapIntensity",0,2).step(.01),c.add(t,"opacity",0,1).step(.01).onChange((function(e){return s.baseColor[3]=e})),c.add(t,"isTransparent"),c.add(t,"alphaCutoff",0,1).step(.01),c.add(t,"getOpacityFromRGB"),c.addColor(s,"baseColor").onChange((function(n){e.guiToColor(n,t.baseColor)})).listen(),c.addColor(s,"emissiveColor").onChange((function(n){e.guiToColor(n,t.emissiveColor)})),c.add(s,"baseTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.baseTexture="None"===e?null:n.textures[e]||o.baseTexture})),c.add(s,"normalTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.normalTexture="None"===e?null:n.textures[e]||o.normalTexture})),c.add(s,"emissiveTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.emissiveTexture="None"===e?null:n.textures[e]||o.emissiveTexture})),c.add(s,"occlusionTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.occlusionTexture="None"===e?null:n.textures[e]||o.occlusionTexture})),c.add(s,"opacityTexture",["None","origin"].concat(Object(i.a)(Object.keys(n.textures)))).onChange((function(e){t.opacityTexture="None"===e?null:n.textures[e]||o.opacityTexture})),c.open()}}}))},t.loadAnimationGUI=function(e){if(null!=e&&e.length){this.gltfRootEntity.getComponent(A.Animation).playAnimationClip(e[0].name);e[0].name}},e}();function u(e){return Object(s.useEffect)((function(){var e=new l;return function(){e.engine.destroy()}})),o.a.createElement(o.a.Fragment,null,o.a.createElement(a.a,e,o.a.createElement("div",{className:"page-gltf-view"},o.a.createElement("canvas",{id:"canvas-gltf-viewer",style:{width:"100%",height:"calc(100vh - 102px)"}}),o.a.createElement("input",{id:"input",type:"file",className:"hide"}),o.a.createElement("div",{id:"dropZone",className:"dropZone"},o.a.createElement("img",{id:"close",className:"closeIcon",src:"https://gw.alipayobjects.com/mdn/mybank_yul/afts/img/A*B7GAQq_VPyIAAAAAAAAAAABkARQnAQ",alt:""}),o.a.createElement("p",null,"拖拽 gltf 2.0 规范的文件或者文件夹到此页面进行预览"),o.a.createElement("p",null,"拖拽支持的图片或者文件夹到此页面，调试纹理贴图"),o.a.createElement("br",null),o.a.createElement("p",null,"模型格式支持:.gltf .glb .bin"),o.a.createElement("p",null,"贴图格式支持:.jpg .png")),o.a.createElement("div",{id:"spinner",className:"spinner hide"}),o.a.createElement("script",{type:"module",src:"./src/index.ts"}))))}},Qr5y:function(e,t,n){}}]);